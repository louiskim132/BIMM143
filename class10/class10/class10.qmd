---
title: "class10"
author: "Jaewon Kim"
format: html
---

# The PDB database

Here we examine the size and composition of the main database of biomolecular structures - the PDB.

Get a CSV file from the PDB database and read it into R.

```{r}
stat_summary <- read.csv("pdb stat summary.csv", row.names = 1)
stat_summary
```

My pdbstats data frame has numbers with commas in them. This may cause us problems. Let's see

```{r}
stat_summary$X.ray #chr with numbers
```

I can turn this snipet into a function that I can use for every column in the table

```{r}
commasum <- function (x) {
  sum(as.numeric(gsub(",", "", x)))
}

commasum(stat_summary$X.ray)
```

Apply accross all columns

```{r}
totals <- apply(stat_summary, 2, commasum)
totals
(totals/totals["Total"])*100
```

Q1: What percentage of structures in the PDB are solved by X-Ray and Electron Microscopy.

From the code above, 84.544% of structures are solved by X-ray and 8.724% by EM.


Q2: What proportion of structures in the PDB are protein?
```{r}
total.row <- apply(stat_summary, 1, commasum)
(total.row/sum(total.row))*100
```
Therefore, 86.654% of structures in PDB are protein.


Q3: Type HIV in the PDB website search box on the home page and determine how many HIV-1 
protease structures are in the current PDB? 

There are 26,090 structures of HIV-1 protease in current PDB.
![](search_result.png)


Q4: Water molecules normally have 3 atoms. Why do we see just one atom per water molecule in this structure?

Oxygen atoms is larger than hydrogen atoms that size of hydrogen atoms are insignificant compared to oxygen and rest of protein structure (Also prof. said hydrogen are too small to be visible in size during lecture?). Therefore, only oxygen molecule is displayed.


Q5: There is a critical “conserved” water molecule in the binding site. Can you identify this water molecule? What residue number does this water molecule have

HOH308 is forming bond with both ligand and I50 in protein.


# Visualizing Protein Structure

We will learn the basics of Mol\* (mol-star) homepage: https://molstar.org/viewer/

We will play with PDB code 1HSG

![](1HSG.png)


Q6: Generate and save a figure clearly showing the two distinct chains of HIV-protease along with the ligand. You might also consider showing the catalytic residues ASP 25 in each chain and the critical water (we recommend “Ball & Stick” for these side-chains). Add this figure to your Quarto document.

![HIV-Pr with a bound inhibitor showing the two important ASP 25](1HSG_ASP25.png)

Discussion Topic: Can you think of a way in which indinavir, or even larger ligands and substrates, could enter the binding site?

If question is asking "How do ligans enter binding site" : Two chains rotates (like twist) that binding site opens up, making larger space for ligand to enter. As ligand form bond with protein, two chains untwist and closes its binding site.

If question is asking "is there way to modify protein so that larger ligand can bind" : Maybe modify protein usign bump and hole method so that larger ligands have a space to bind.


## Back to R and working with PDB structure

Predict the dynmics (flexibility) of an important protein:

```{r}
library(bio3d)

hiv <- read.pdb("1hsg")
hiv
```


Q7: How many amino acid residues are there in this pdb object? 

There are 198 aa residues.


Q8: Name one of the two non-protein residues? 

There are 128 non-protein residues, where their types are HOH (water) and 
MK1 (inhibitor)


Q9: How many protein chains are in this structure? 

There are two chains, chain A and B.


```{r}
head(hiv$atom)
pdbseq(hiv)
```

Here we will do a normal mode analysis (nma) to predict functional motion of a kinase

```{r}
adk <- read.pdb("6s36")
adk
```

```{r}
modes <- nma(adk)
plot(modes)
```

Make a "movie" called a trajectory of the predicted motions:

```{r}
mktrj(modes, file = "adk_m7.pdb")
```

Then I can open this file in Mol\*...

```{r}
modes1 <- nma(read.pdb("1hsg"))
mktrj(modes1, file = "1hsg_m7.pdb")
```

install.packages("bio3d")
install.packages("devtools")
install.packages("BiocManager")
BiocManager::install("msa")
devtools::install_bitbucket("Grantlab/bio3d-view")

Q10. Which of the packages above is found only on BioConductor and not CRAN? 

msa package is found only on BioConductor.


Q11. Which of the above packages is not found on BioConductor or CRAN?

bio3d-view (Grantlab/bio3d-view) is found only on bitbucket.


Q12. True or False? Functions from the devtools package can be used to install packages from GitHub and BitBucket?

True.


```{r}
library(bio3d)
aa <- get.seq("1ake_A")
aa
```

Q13. How many amino acids are in this sequence, i.e. how long is this sequence?

There are 214 aa in this sequence.


```{r}
#b <- blast.pdb(aa)
#hits <- plot(b)
#head(hits$pdb.id)
#Takes to long

#hits <- NULL
#hits$pdb.id <- c('1AKE_A','6S36_A','6RZE_A','3HPR_A','1E4V_A','5EJE_A','1E4Y_A','3X2S_A','6HAP_A','6HAM_A','4K46_A','3GMT_A','4PZL_A')

#files <- get.pdb(hits$pdb.id, path="pdbs", split=TRUE, gzip=TRUE)
pdbs <- pdbaln(files, fit = TRUE, exefile="msa")
#ids <- basename.pdb(pdbs$id)
#plot(pdbs, labels=ids)
```

```{r}
#Why is this not working? Please commentttt
library(bio3d.view)
library(rgl)

view.pdbs(pdbs)
```

```{r}
anno <- pdb.annotate(ids)
unique(anno$source)
anno
```

```{r}
pc.xray <- pca(pdbs)
plot(pc.xray)

rd <- rmsd(pdbs)

hc.rd <- hclust(dist(rd))
grps.rd <- cutree(hc.rd, k=3)

plot(pc.xray, 1:2, col="grey50", bg=grps.rd, pch=21, cex=1)
```

```{r}
library(ggplot2)
library(ggrepel)

df <- data.frame(PC1=pc.xray$z[,1], 
                 PC2=pc.xray$z[,2], 
                 col=as.factor(grps.rd),
                 ids=ids)

p <- ggplot(df) + 
  aes(PC1, PC2, col=col, label=ids) +
  geom_point(size=2) +
  geom_text_repel(max.overlaps = 20) +
  theme(legend.position = "none")
p
```

```{r}
modes <- nma(pdbs)
plot(modes, pdbs, col=grps.rd)
```

Q14. What do you note about this plot? Are the black and colored lines similar or different? Where do you think they differ most and why?

Colored line and black lines are different in flucuations around residue 1~50 and 120~170. Fluctuation differs the most around residue 130. This is because corresponding area is where protein moves (open and close activation site) to enable substrate binding. 

